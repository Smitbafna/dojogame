{"version":3,"sources":["dist/penpal.js"],"names":["Penpal","MessageType","Resolution","ErrorCode","NativeErrorName","NativeEventType","createDestructor","localName","log","callbacks","destroyed","[object Object]","error","forEach","callback","push","createLogger","debug","_len","arguments","length","args","Array","_key","console","DEFAULT_PORT_BY_PROTOCOL","http:","https:","URL_REGEX","opaqueOriginSchemes","getOriginFromSrc","src","find","scheme","startsWith","location","document","regexResult","exec","protocol","hostname","port","portSuffix","serializeError","_ref","name","message","stack","deserializeError","obj","deserializedError","Error","Object","keys","key","connectCallReceiver","info","serializedMethods","local","remote","originForSending","originForReceiving","handleMessageEvent","event","source","data","penpal","Call","origin","callMessage","methodName","id","createPromiseHandler","resolution","returnValue","Reply","Rejected","returnValueIsError","postMessage","err","DataCloneError","errorReplyMessage","Promise","resolve","call","apply","then","Fulfilled","addEventListener","Message","removeEventListener","generateId","KEY_PATH_DELIMITER","keyPathToSegments","keyPath","split","segmentsToKeyPath","segments","join","createKeyPath","prefix","setAtKeyPath","subject","value","reduce","prevSubject","idx","serializeMethods","methods","flattenedMethods","assign","deserializeMethods","connectCallSender","callSender","methodKeyPaths","destroyConnection","createMethodProxy","iframeRemoved","closed","e","code","ConnectionDestroyed","reject","replyMessage","api","handleAckMessageFactory","childOrigin","destructor","destroy","onDestroy","destroyCallReceiver","receiverMethodNames","window","receiverMethodName","methodNames","destroyCallSender","handleSynMessageFactory","synAckMessage","SynAck","CHECK_IFRAME_IN_DOC_INTERVAL","monitorIframeRemoval","iframe","checkIframeInDocIntervalId","setInterval","isConnected","clearInterval","startConnectionTimeout","timeout","timeoutId","undefined","setTimeout","ConnectionTimeout","clearTimeout","validateIframeHasSrcOrSrcDoc","srcdoc","NoIframeSrc","connectToChild","options","handleSynMessage","handleAckMessage","promise","stopConnectionTimeout","handleMessage","contentWindow","Syn","Ack","handleSynAckMessageFactory","parentOrigin","originQualifies","RegExp","test","ackMessage","parent","areGlobalsAccessible","connectToParent","handleSynAckMessage","sendSynMessage","synMessage","parentOriginForSyn","indexForBundle"],"mappings":"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"}